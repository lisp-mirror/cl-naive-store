<html><head><style type='text/css'>
*.state-0 { background-color: #eeeeee }
*.state-1 { background-color: #aaffaa }
*.state-5 { background-color: #44dd44 }
*.state-2 { background-color: #ffaaaa }
*.state-10 { background-color: #ee6666 }
*.state-15 { color: #aaaaaa; background-color: #eeeeee }
*.state-9,*.state-6 { background-color: #ffffaa }
div.key { margin: 20px; width: 200px }
div.source { width: 88ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */ }

*.line-number { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }
</style></head><body><h3>Coverage report: /home/phil/source/naive/cl-naive-store/src/naive-store/naive-impl/parse-document.lisp <br />
</h3>
<table class='summary'><tr class='head-row'><td width='80px'>Kind</td><td width='80px'>Covered</td><td width='80px'>All</td><td width='80px'>%</td><tr class='odd'><td>expression</td><td>54</td><td>304</td><td> 17.8</td></tr>
<tr class='even'><td>branch</td><td>4</td><td>38</td><td> 10.5</td></tr>
</table><div class='key'><b>Key</b><br />
<div class='state-0'>Not instrumented</div><div class='state-15'>Conditionalized out</div><div class='state-1'>Executed</div><div class='state-2'>Not executed</div><div>&#160;</div><div class='state-5'>Both branches taken</div><div class='state-6'>One branch taken</div><div class='state-10''>Neither branch taken</div></div><nobr><div><code>
</code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>1</code></div><code>&#160;<span class='state-2'>&#40;in&#45;package&#160;&#58;naive&#45;impl&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>2</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>3</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;Do&#160;we&#160;need&#160;to&#160;implement&#160;a&#160;generic&#160;function&#160;so&#160;that&#160;we&#160;can&#160;deal&#160;with&#160;multiverse&#63;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>4</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;We&#160;need&#160;to&#160;save&#160;the&#160;universe&#160;as&#160;well&#160;if&#160;we&#160;want&#160;to&#160;take&#160;full&#160;advantage&#160;of&#160;multiverse&#160;concept&#46;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>5</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>6</code></div><code>&#160;<span class='state-0'>&#59;&#59;Yes&#160;we&#160;need&#160;generic&#160;functions&#160;so&#160;we&#160;can&#160;deal&#160;with&#160;multiverse&#160;in&#160;a</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>7</code></div><code>&#160;<span class='state-0'>&#59;&#59;backwards&#160;compatible&#160;way&#33;&#33;&#33;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>8</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>9</code></div><code>&#160;<span class='state-2'>&#40;defun&#160;load&#45;document&#45;reference&#45;collection&#160;&#40;universe&#160;document&#45;ref&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>10</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#34;When&#160;documents&#160;are&#160;persisted&#160;to&#160;file&#160;any&#160;document&#160;values&#160;that&#160;are&#160;referencing&#160;a&#160;document&#160;in&#160;a&#160;different&#160;collection&#160;is&#160;first&#160;sanitized&#160;&#40;just&#160;enough&#160;info&#160;to&#160;retrieve&#160;the&#160;document&#160;later&#160;from&#160;where&#160;it&#160;is&#160;stored&#41;&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>11</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>12</code></div><code>&#160;<span class='state-2'>When&#160;documents&#160;are&#160;read&#160;from&#160;a&#160;file&#160;the&#160;references&#160;need&#160;to&#160;be&#160;converted&#160;to&#160;documents&#160;but&#160;for&#160;that&#160;to&#160;happen&#160;the&#160;collection&#160;containing&#160;the&#160;referenced&#160;documents&#160;need&#160;to&#160;be&#160;loaded&#160;first&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>13</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>14</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;&#40;break&#160;&#34;load&#160;ref&#160;collection&#160;&#126;S&#34;&#160;&#160;document&#45;ref&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>15</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>16</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;TODO&#58;&#160;Doing&#160;this&#160;and&#160;other&#160;crazies&#160;for&#160;backwards&#160;compatibility&#44;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>17</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;should&#160;be&#160;removed&#160;at&#160;some&#160;stage&#160;and&#160;an&#160;error&#160;should&#160;be&#160;raised&#160;if</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>18</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;no&#160;multiverse&#160;is&#160;set&#160;for&#160;the&#160;universe&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>19</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;multiverse&#160;&#40;or&#160;&#40;multiverse&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>20</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Universe&#160;has&#160;no&#160;parent&#160;multiverse&#46;&#34;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>21</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>22</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;let&#42;&#160;&#40;&#40;universe&#45;name&#160;&#40;or&#160;&#40;getx&#160;document&#45;ref&#160;&#58;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>23</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;universe&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>24</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;reference&#45;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>25</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>26</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;and&#160;</span><span class='state-10'>&#40;not&#160;&#40;getx&#160;</span><span class='state-2'>document&#45;ref</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;universe</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>27</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>28</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;and&#160;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>&#40;getx&#160;document&#45;ref&#160;&#58;universe&#41;</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;name&#160;universe&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>29</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>30</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;ref&#45;uni&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>31</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>32</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;multiverse&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>33</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;universe&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>34</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;ref&#45;uni</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>35</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>36</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;and&#160;</span><span class='state-10'>&#40;get&#45;definition&#160;</span><span class='state-2'>&#40;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>37</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#58;universe</span><span class='state-10'>&#160;</span><span class='state-2'>universe&#45;name</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>38</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;instance&#45;from&#45;definition&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>39</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>40</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>41</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;universe&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>42</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;progn</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>43</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;If&#160;we&#160;get&#160;here&#160;then&#160;it&#160;means&#160;we&#160;are&#160;dealing&#160;with&#160;a</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>44</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;very&#160;brokend&#160;database&#46;&#160;Should&#160;consider&#160;removing&#160;this&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>45</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>46</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Reference&#160;Universe&#160;does&#160;not&#160;exist&#160;&#126;S&#34;&#160;document&#45;ref&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>47</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>48</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35;&#124;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>49</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;instance&#160;&#40;universe&#45;class&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>50</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;universe&#45;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>51</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;directory</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>52</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>53</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>54</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;directory&#160;&#40;list&#160;&#58;relative</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>55</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;universe&#45;name&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>56</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store&#45;class&#160;&#39;store&#41;&#124;&#35;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>57</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;store&#160;&#40;and&#160;reference&#45;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>58</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>59</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>60</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>61</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reference&#45;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>62</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>63</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;instance&#45;from&#45;definition&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>64</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;reference&#45;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>65</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>66</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;store&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>67</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;collection&#160;&#40;and&#160;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>68</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>69</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>70</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>71</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>72</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>73</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;instance&#45;from&#45;definition&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>74</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>75</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>76</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;document&#45;ref&#160;&#58;collection&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>77</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shard&#45;mac&#160;&#40;getx&#160;document&#45;ref&#160;&#58;shard&#45;mac&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>78</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>79</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;shard&#45;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>80</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;shard&#160;&#40;get&#45;shard&#160;collection&#160;shard&#45;mac&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>81</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>82</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>83</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;load&#45;shard&#160;collection&#160;shard&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>84</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;load&#45;data&#160;collection&#160;&#58;parallel&#45;p&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>85</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;load&#45;data&#160;collection&#160;&#58;parallel&#45;p&#160;nil&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>86</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>87</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>88</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>89</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;find&#45;document&#45;by&#45;hash&#160;&#40;collection&#160;hash&#160;&#38;key&#160;shards&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>90</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Finds&#160;the&#160;document&#160;that&#160;matches&#160;the&#160;hash&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>91</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>92</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;Deal&#160;with&#160;shards&#46;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>93</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;find&#45;document&#45;by&#45;hash&#160;&#40;collection&#160;hash&#160;&#38;key&#160;shards&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>94</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;do&#45;sequence&#160;&#40;shard&#160;&#40;if&#160;shards&#160;shards</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>95</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shards&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>96</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;parallel&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>97</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>98</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>99</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;document&#160;&#40;documents&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>100</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;</span><span class='state-10'>&#40;string&#45;equal</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>101</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;getx&#160;document&#160;&#58;hash&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>102</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;</span><span class='state-2'>hash</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>103</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>104</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;return&#45;from&#160;find&#45;document&#45;by&#45;hash&#160;document&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>105</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>106</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;Implment&#160;hash&#45;table&#46;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>107</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;type&#45;of&#45;sexp&#160;&#40;collection&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>108</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Reports&#160;if&#160;the&#160;sexp&#160;represents&#160;a&#160;special&#160;form&#44;&#160;like&#160;a&#160;blob&#160;or&#160;reference&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>109</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>110</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;type&#45;of&#45;sexp&#160;&#40;collection&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>111</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;declare&#160;&#40;ignorable&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>112</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>113</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-10'>&#40;and&#160;&#40;listp&#160;</span><span class='state-2'>sexp</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>114</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;equalp&#160;&#40;car&#160;sexp&#41;&#160;&#58;blob&#37;&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>115</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;blob&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>116</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;and&#160;&#40;listp&#160;</span><span class='state-2'>sexp</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>117</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;equalp&#160;&#40;car&#160;sexp&#41;&#160;&#58;&#124;hash&#45;table&#124;&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>118</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;hash&#45;table&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>119</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;and&#160;&#40;listp&#160;</span><span class='state-2'>sexp</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>120</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#40;atom&#160;&#40;car&#160;</span><span class='state-2'>sexp</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>121</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;symbolp&#160;&#40;car&#160;sexp&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>122</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;cl&#45;getx&#58;getx&#160;sexp&#160;&#58;reference&#37;&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>123</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;reference&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>124</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>125</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;t&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>126</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>127</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;compose&#45;special&#160;&#40;collection&#160;shard&#160;sexp&#160;type</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>128</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;handle&#45;duplicates&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>129</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Does&#160;special&#160;processing&#160;to&#160;compose&#160;a&#160;specific&#160;type&#160;of&#160;document&#160;or&#160;element&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>130</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>131</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;compose&#45;special&#160;&#40;collection&#160;shard&#160;sexp&#160;&#40;type&#160;&#40;eql&#160;&#58;document&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>132</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;</span><span class='state-2'>&#40;handle&#45;duplicates&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>133</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;&#58;debug&#45;log&#160;&#34;core&#58;Compose&#45;special&#160;&#58;document&#160;&#126;A&#34;&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>134</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-6'>&#40;getx&#160;</span><span class='state-1'>sexp</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;deleted&#45;p</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>135</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;remove&#45;document&#160;collection&#160;sexp&#160;&#58;shard&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>136</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;TODO&#58;&#160;Where&#160;to&#160;get&#160;handle&#45;duplicates&#45;p&#160;&#63;&#63;&#63;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>137</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;add&#45;document&#160;collection&#160;sexp&#160;&#58;shard&#160;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>138</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;handle&#45;duplicates&#45;p&#160;handle&#45;duplicates&#45;p&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>139</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>140</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;compose&#45;special&#160;&#40;collection&#160;shard&#160;sexp&#160;&#40;type&#160;&#40;eql&#160;&#58;blob&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>141</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;handle&#45;duplicates&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>142</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;declare&#160;&#40;ignorable&#160;collection&#41;&#160;&#40;ignorable&#160;shard&#41;&#160;&#40;ignorable&#160;type&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>143</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;ignore&#160;handle&#45;duplicates&#45;p&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>144</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>145</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;read&#45;blob&#160;&#40;cdr&#160;sexp&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>146</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>147</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;compose&#45;special&#160;&#40;collection&#160;shard&#160;sexp&#160;&#40;type&#160;&#40;eql&#160;&#58;hash&#45;table&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>148</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;handle&#45;duplicates&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>149</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;declare&#160;&#40;ignorable&#160;collection&#41;&#160;&#40;ignorable&#160;shard&#41;&#160;&#40;ignorable&#160;sexp&#41;&#160;&#40;ignorable&#160;type&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>150</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;ignorable&#160;handle&#45;duplicates&#45;p&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>151</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;error&#160;&#34;Reading&#160;of&#160;hash&#45;tables&#160;not&#160;implmented&#160;yet&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>152</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>153</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;compose&#45;special&#160;&#40;collection&#160;shard&#160;sexp&#160;&#40;type&#160;&#40;eql&#160;&#58;reference&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>154</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;handle&#45;duplicates&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>155</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;declare&#160;&#40;ignorable&#160;shard&#41;&#160;&#40;ignore&#160;handle&#45;duplicates&#45;p&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>156</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>157</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;naive&#45;impl&#58;&#58;debug&#45;log&#160;&#34;core&#58;Compose&#45;special&#160;&#58;reference&#160;&#126;A&#34;&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>158</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>159</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#42;&#160;&#40;&#40;ref&#45;collection&#160;&#40;load&#45;document&#45;reference&#45;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>160</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>161</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>162</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;Assuming&#160;that&#160;the&#160;referenced&#160;collections</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>163</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;are&#160;loaded&#160;before&#160;the&#160;referencing</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>164</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;collection&#44;&#160;if&#160;the&#160;reference&#160;already</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>165</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;contains&#160;&#58;collection&#160;&#160;and&#160;&#58;store&#44;&#160;don&#39;t</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>166</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;override&#160;it&#160;to&#160;the&#160;current&#160;one&#160;&#40;which&#160;is</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>167</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;BEING&#160;loaded&#41;&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>168</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>169</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;and&#160;&#40;getx&#160;</span><span class='state-2'>sexp</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;collection</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>170</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;getx&#160;sexp&#160;&#58;store&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>171</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sexp</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>172</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#42;&#160;&#58;collection&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>173</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store&#160;&#40;name&#160;&#40;store&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>174</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sexp&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>175</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;ref&#45;document&#160;&#40;and&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>176</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;find&#45;document&#45;by&#45;hash</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>177</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ref&#45;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>178</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;getx&#160;sexp&#160;&#58;hash&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>179</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;shards&#160;&#40;shards&#160;ref&#45;collection&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>180</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>181</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#59;&#59;&#160;&#40;break&#160;&#34;compose&#160;reference&#160;&#126;S&#34;&#160;ref&#45;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>182</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;unless&#160;ref&#45;document</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>183</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;write&#45;log&#160;&#40;location&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>184</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;error&#160;&#40;list&#160;&#34;Could&#160;not&#160;resolve&#160;reference&#34;&#160;sexp&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>185</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>186</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;naive&#45;impl&#58;&#58;debug&#45;log&#160;&#34;END&#160;core&#58;Compose&#45;special&#160;&#58;reference&#160;&#126;A&#34;&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>187</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>188</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;ref&#45;document&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>189</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>190</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;compose&#45;document&#160;&#40;collection&#160;shard&#160;document&#45;form&#160;&#38;key</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>191</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;handle&#45;duplicates&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>192</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;The&#160;loading&#160;of&#160;documents&#160;happens&#160;in&#160;a&#160;two&#160;step&#160;process&#46;&#160;First&#160;documents&#160;are&#160;read&#160;with&#160;&#40;&#42;read&#45;eval&#42;&#160;nil&#41;&#46;&#160;Then&#160;the&#160;sexp&#160;representing&#160;a&#160;raw&#160;document&#160;is&#160;processed&#160;to&#160;compose&#160;the&#160;required&#160;in&#160;memory&#160;representation&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>193</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>194</code></div><code>&#160;<span class='state-0'>&#59;&#59;Made&#160;this&#160;a&#160;seperate&#160;method&#160;so&#160;simple&#160;units&#160;tests&#160;can&#160;test&#160;basic&#160;parsing&#46;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>195</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;compose&#45;parse&#160;&#40;collection&#160;shard&#160;sexp&#160;doc&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>196</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Processes&#160;document&#160;form&#160;for&#160;compose&#45;document&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>197</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>198</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;compose&#45;parse&#160;&#40;collection&#160;shard&#160;sexp&#160;doc&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>199</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-5'>&#40;null&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>200</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;nreverse&#160;doc&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>201</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-6'>&#40;consp&#160;</span><span class='state-1'>&#40;car&#160;sexp&#41;</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>202</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;compose&#45;parse&#160;collection&#160;shard&#160;&#40;cdr&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>203</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;type&#45;of&#45;sexp&#160;</span><span class='state-2'>collection</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;car&#160;sexp&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>204</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cons</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>205</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;compose&#45;special&#160;collection&#160;shard&#160;&#40;car&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>206</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;type&#45;of&#45;sexp&#160;collection&#160;&#40;car&#160;sexp&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>207</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>208</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cons&#160;&#40;compose&#45;parse&#160;collection&#160;shard&#160;&#40;car&#160;sexp&#41;&#160;nil&#41;&#160;doc&#41;&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>209</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;t</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>210</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;compose&#45;parse&#160;collection&#160;shard&#160;&#40;cdr&#160;sexp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>211</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cons&#160;&#40;car&#160;sexp&#41;&#160;doc&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>212</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>213</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;compose&#45;document&#160;&#40;collection&#160;shard&#160;document&#45;form&#160;&#38;key</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>214</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;handle&#45;duplicates&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>215</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;&#58;debug&#45;log&#160;&#34;core&#58;Compose&#45;document&#160;&#126;A&#34;&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>216</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;doc</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>217</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;compose&#45;special&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>218</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>219</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;compose&#45;parse&#160;collection&#160;shard&#160;document&#45;form&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>220</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;document</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>221</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;handle&#45;duplicates&#45;p&#160;handle&#45;duplicates&#45;p&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>222</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;naive&#45;impl&#58;&#58;debug&#45;log&#160;&#34;END&#160;core&#58;Compose&#45;document&#160;&#126;A&#34;&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>223</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;doc&#41;&#41;</code></div></body></html>