<html><head><style type='text/css'>
*.state-0 { background-color: #eeeeee }
*.state-1 { background-color: #aaffaa }
*.state-5 { background-color: #44dd44 }
*.state-2 { background-color: #ffaaaa }
*.state-10 { background-color: #ee6666 }
*.state-15 { color: #aaaaaa; background-color: #eeeeee }
*.state-9,*.state-6 { background-color: #ffffaa }
div.key { margin: 20px; width: 200px }
div.source { width: 88ex; background-color: #eeeeee; padding-left: 5px;
             /* border-style: solid none none none; border-width: 1px;
             border-color: #dddddd */ }

*.line-number { color: #666666; float: left; width: 6ex; text-align: right; margin-right: 1ex; }

table.summary tr.head-row { background-color: #aaaaff }
table.summary tr td.text-cell { text-align: left }
table.summary tr td.main-head { text-align: center }
table.summary tr td { text-align: right }
table.summary tr.even { background-color: #eeeeff }
table.summary tr.subheading { background-color: #aaaaff}
table.summary tr.subheading td { text-align: left; font-weight: bold; padding-left: 5ex; }
</style></head><body><h3>Coverage report: /home/phil/source/naive/cl-naive-store/src/naive-store/naive-core.lisp <br />
</h3>
<table class='summary'><tr class='head-row'><td width='80px'>Kind</td><td width='80px'>Covered</td><td width='80px'>All</td><td width='80px'>%</td><tr class='odd'><td>expression</td><td>568</td><td>1267</td><td> 44.8</td></tr>
<tr class='even'><td>branch</td><td>41</td><td>160</td><td> 25.6</td></tr>
</table><div class='key'><b>Key</b><br />
<div class='state-0'>Not instrumented</div><div class='state-15'>Conditionalized out</div><div class='state-1'>Executed</div><div class='state-2'>Not executed</div><div>&#160;</div><div class='state-5'>Both branches taken</div><div class='state-6'>One branch taken</div><div class='state-10''>Neither branch taken</div></div><nobr><div><code>
</code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>1</code></div><code>&#160;<span class='state-2'>&#40;in&#45;package&#160;&#58;cl&#45;naive&#45;store&#46;naive&#45;core&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>2</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>3</code></div><code>&#160;<span class='state-2'>&#40;defclass&#160;shard&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>4</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#40;mac&#160;&#58;initarg&#160;&#58;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>5</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>6</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>7</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Mac&#160;to&#160;identify&#160;shard&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>8</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;location&#160;&#58;initarg&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>9</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>10</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>11</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;file&#160;path&#160;to&#160;this&#160;shard&#160;is&#160;stored&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>12</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;documents&#160;&#58;initarg&#160;&#58;documents</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>13</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;documents</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>14</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#40;make&#45;array&#160;1&#160;&#58;fill&#45;pointer&#160;0&#160;&#58;adjustable&#160;t&#160;&#58;initial&#45;element&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>15</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Documents&#160;belonging&#160;to&#160;shard&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>16</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;status&#160;&#58;initarg&#160;&#58;status&#160;&#59;&#59;&#160;accessor&#160;is&#160;defined&#160;below&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>17</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>18</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Used&#160;internally&#160;during&#160;the&#160;loading&#160;of&#160;the&#160;documents&#160;in&#160;a&#160;shard&#160;to&#160;help&#160;with&#160;locking&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>19</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;lock&#160;&#58;initarg&#160;&#58;lock</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>20</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;lock</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>21</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#40;list&#160;&#58;docs&#160;&#40;bt&#58;make&#45;lock&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>22</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;hash&#45;index&#160;&#40;bt&#58;make&#45;lock&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>23</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;values&#45;index&#160;&#40;bt&#58;make&#45;lock&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>24</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Used&#160;internally&#160;to&#160;do&#160;shard&#160;specific&#160;locking&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>25</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>26</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Sharding&#160;is&#160;when&#160;you&#160;break&#160;the&#160;physical&#160;file&#160;that&#160;backs&#160;the&#160;collection&#160;into&#160;smaller&#160;files&#160;based&#160;on&#160;data&#160;elements&#160;of&#160;a&#160;document&#46;&#160;An&#160;instance&#160;of&#160;a&#160;shard&#160;class&#160;is&#160;used&#160;to&#160;load&#160;the&#160;documents&#160;belonging&#160;to&#160;the&#160;shard&#160;into&#160;memory&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>27</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>28</code></div><code>&#160;<span class='state-2'>&#40;defclass&#160;collection&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>29</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#40;store&#160;&#58;initarg&#160;&#58;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>30</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>31</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>32</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;store&#160;that&#160;this&#160;collection&#160;belongs&#160;to&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>33</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;name&#160;&#58;initarg&#160;&#58;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>34</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>35</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;collection&#160;name&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>36</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;location&#160;&#58;initarg&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>37</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>38</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>39</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;directory&#160;path&#160;to&#160;where&#160;files&#160;for&#160;this&#160;collection&#160;are&#160;stored&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>40</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;shards&#160;&#58;initarg&#160;&#58;shards</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>41</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;shards</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>42</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#40;make&#45;array&#160;1&#160;&#58;fill&#45;pointer&#160;0&#160;&#58;adjustable&#160;t&#160;&#58;initial&#45;element&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>43</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;cl&#58;vector</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>44</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;A&#160;vector&#160;of&#160;shards&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>45</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>46</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>47</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>48</code></div><code>&#160;<span class='state-2'>&#160;Originally&#160;naive&#45;store&#160;used&#160;lists&#160;but&#160;with&#160;the&#160;re&#45;introduction&#160;of&#160;sharding&#44;&#160;we&#160;chose&#160;to&#160;also&#160;introduce&#160;the&#160;use&#160;of&#160;lparrallel&#160;to&#160;speed&#160;up&#160;many&#160;functions&#160;and&#160;lparrallel&#160;has&#160;a&#160;preference&#160;for&#160;arrays&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>49</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>50</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;keys&#160;&#58;initarg&#160;&#58;keys</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>51</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;keys</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>52</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#40;list&#160;&#58;key&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>53</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Keys&#160;need&#160;to&#160;be&#160;set&#160;to&#160;handle&#160;duplicates&#44;&#160;the&#160;default&#160;is&#160;&#58;key&#160;if&#160;&#58;key&#160;is&#160;not&#160;found&#160;in&#160;the&#160;document&#160;then&#160;duplicates&#160;will&#160;occur&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>54</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>55</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>56</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>57</code></div><code>&#160;<span class='state-2'>For&#160;collections&#160;that&#160;use&#160;cl&#45;naive&#45;document&#45;type&#160;there&#160;is&#160;a&#160;fallback&#160;the&#160;document&#45;type&#160;is&#160;checked&#160;for&#160;keys&#160;as&#160;well&#160;and&#160;the&#160;collection&#39;s&#160;keys&#160;will&#160;be&#160;set&#160;to&#160;the&#160;keys&#160;set&#160;in&#160;the&#160;document&#45;type&#160;elements&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>58</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;shard&#45;elements&#160;&#58;initarg&#160;&#58;shard&#45;elements</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>59</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;shard&#45;elements</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>60</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>61</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;shard&#45;elements&#160;is&#160;a&#160;list&#160;of&#160;document&#160;element&#160;keywords&#160;to&#160;use&#160;for&#160;sharding&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>62</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>63</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;A&#160;collection&#160;of&#160;documents&#160;of&#160;a&#160;specific&#160;document&#45;type&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>64</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>65</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;add&#160;parameter&#160;to&#160;select&#160;vector&#160;or&#160;list&#160;as&#160;output</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>66</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;documents&#160;&#40;&#40;collection&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>67</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Loops&#160;over&#160;all&#160;the&#160;shards&#160;for&#160;a&#160;collection&#160;to&#160;gather&#160;all&#160;the&#160;documents&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>68</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;documents&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>69</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;shard&#160;&#40;shards&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>70</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;documents&#160;&#40;concatenate&#160;&#39;list&#160;documents&#160;&#40;documents&#160;shard&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>71</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;documents&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>72</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>73</code></div><code>&#160;<span class='state-2'>&#40;defclass&#160;store&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>74</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#40;universe&#160;&#58;initarg&#160;&#58;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>75</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>76</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>77</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;universe&#160;the&#160;store&#160;belongs&#160;to&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>78</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;name&#160;&#58;initarg&#160;&#58;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>79</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>80</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Store&#160;name&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>81</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;collection&#45;class&#160;&#58;initarg&#160;&#58;collection&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>82</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;collection&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>83</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#39;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>84</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;allocation&#160;&#58;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>85</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;class&#160;that&#160;should&#160;be&#160;used&#160;to&#160;make&#160;collections&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>86</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;collections&#160;&#58;initarg&#160;&#58;collections</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>87</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;collections</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>88</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>89</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;List&#160;of&#160;collections&#160;represented&#160;by&#160;this&#160;store&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>90</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;location&#160;&#58;initarg&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>91</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>92</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>93</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;directory&#160;path&#160;to&#160;the&#160;document&#45;type&#160;files&#160;and&#160;collection&#160;files&#160;for&#160;this&#160;store&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>94</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Document&#160;types&#160;and&#160;their&#160;associated&#160;collections&#160;are&#160;organized&#160;into&#160;groups&#160;called&#160;stores&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>95</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>96</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>97</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>98</code></div><code>&#160;<span class='state-2'>collection&#45;class&#160;and&#160;document&#45;type&#45;class&#160;is&#160;delcaritively&#160;specied&#160;here&#160;because&#160;they&#160;are&#160;dynamicly&#160;created&#160;when&#160;definition&#160;files&#160;are&#160;loaded&#46;&#160;The&#160;alternative&#160;would&#160;be&#160;defmethod&#160;hell&#160;where&#160;the&#160;customizer&#160;of&#160;naive&#45;store&#160;would&#160;have&#160;to&#160;implement&#160;a&#160;whole&#160;lot&#160;of&#160;methods&#160;that&#160;do&#160;exactly&#160;what&#160;the&#160;provided&#160;methods&#160;do&#160;just&#160;to&#160;be&#160;able&#160;to&#160;be&#160;type&#160;specific&#160;in&#160;other&#160;methods&#160;where&#160;it&#160;is&#160;actually&#160;needed&#46;&#160;Alternatively&#160;meta&#160;classes&#160;could&#160;be&#160;used&#160;for&#160;element&#45;class&#160;but&#160;that&#160;opens&#160;another&#160;can&#160;of&#160;worms&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>99</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>100</code></div><code>&#160;<span class='state-2'>&#40;defclass&#160;universe&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>101</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#40;multiverse&#160;&#58;initarg&#160;&#58;multiverse</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>102</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;multiverse</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>103</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>104</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;multiverse&#160;the&#160;universe&#160;belongs&#160;to&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>105</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;name&#160;&#58;initarg&#160;&#58;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>106</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>107</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;Initializing&#160;name&#160;to&#160;help&#160;with&#160;backwards</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>108</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;compatibility&#46;&#160;Name&#160;was&#160;intruduced&#160;with&#160;multiverse&#160;and&#160;is</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>109</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;needed&#160;for&#160;references&#160;etc&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>110</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#34;universe&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>111</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Universe&#160;name&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>112</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;stores&#160;&#58;initarg&#160;&#58;stores</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>113</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;stores</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>114</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>115</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;List&#160;of&#160;stores&#160;contained&#160;by&#160;this&#160;universe&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>116</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;store&#45;class&#160;&#58;initarg&#160;&#58;store&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>117</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;store&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>118</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#39;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>119</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;allocation&#160;&#58;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>120</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;class&#160;that&#160;should&#160;be&#160;used&#160;to&#160;make&#160;stores&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>121</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>122</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>123</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>124</code></div><code>&#160;<span class='state-2'>store&#45;class&#160;is&#160;delcaritively&#160;specied&#160;here&#160;because&#160;stores&#160;are&#160;dynamicly</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>125</code></div><code>&#160;<span class='state-2'>created&#160;when&#160;definition&#160;files&#160;are&#160;loaded&#46;&#160;&#40;see&#160;store&#160;notes&#160;for&#160;more</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>126</code></div><code>&#160;<span class='state-2'>about&#160;this&#46;&#41;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>127</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;location&#160;&#58;initarg&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>128</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>129</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>130</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Directory&#160;path&#160;to&#160;stores&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>131</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;shards&#45;cache&#37;&#160;&#58;initarg&#160;&#58;shards&#45;cache&#37;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>132</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;shards&#45;cache&#37;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>133</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>134</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35;&#43;&#40;or&#160;sbcl&#160;ecl&#41;&#160;&#40;make&#45;hash&#45;table&#160;&#58;test&#160;&#39;equalp&#160;&#58;synchronized&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>135</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35;&#43;&#40;not&#160;&#40;or&#160;sbcl&#160;ecl&#41;&#41;&#160;</span><span class='state-15'>&#40;make&#45;hash&#45;table&#160;&#58;test&#160;&#39;equalp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>136</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;This&#160;was&#160;introduced&#160;to&#160;speedup&#160;finding&#160;a&#160;shard&#46;&#160;It&#160;is&#160;only&#160;for&#160;internal&#160;use&#33;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>137</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;shards&#45;macs&#45;cache&#37;&#160;&#58;initarg&#160;&#58;shards&#45;macs&#45;cache&#37;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>138</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;shards&#45;macs&#45;cache&#37;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>139</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>140</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35;&#43;&#40;or&#160;sbcl&#160;ecl&#41;&#160;&#40;make&#45;hash&#45;table&#160;&#58;test&#160;&#39;equalp&#160;&#58;synchronized&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>141</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35;&#43;&#40;not&#160;&#40;or&#160;sbcl&#160;ecl&#41;&#41;&#160;</span><span class='state-15'>&#40;make&#45;hash&#45;table&#160;&#58;test&#160;&#39;equalp&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>142</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;This&#160;was&#160;introduced&#160;to&#160;speedup&#160;finding&#160;a&#160;shard&#46;&#160;Calulating&#160;macs&#160;is&#160;expensive&#46;&#160;It&#160;is&#160;only&#160;for&#160;internal&#160;use&#33;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>143</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Stores&#160;are&#160;held&#160;by&#160;a&#160;universe&#160;to&#160;make&#160;up&#160;a&#160;database&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>144</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>145</code></div><code>&#160;<span class='state-2'>&#40;defclass&#160;multiverse&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>146</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#40;name&#160;&#58;initarg&#160;&#58;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>147</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;name</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>148</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Universe&#160;name&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>149</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;universes&#160;&#58;initarg&#160;&#58;universes</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>150</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;universes</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>151</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>152</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;List&#160;of&#160;universes&#160;contained&#160;by&#160;this&#160;multiverse&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>153</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;universe&#45;class&#160;&#58;initarg&#160;&#58;universe&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>154</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;universe&#45;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>155</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#39;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>156</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;allocation&#160;&#58;class</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>157</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;The&#160;class&#160;that&#160;should&#160;be&#160;used&#160;to&#160;make&#160;universes&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>158</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>159</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>160</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>161</code></div><code>&#160;<span class='state-2'>universe&#45;class&#160;is&#160;delcaritively&#160;specied&#160;here&#160;because&#160;stores&#160;are</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>162</code></div><code>&#160;<span class='state-2'>dynamicly&#160;created&#160;when&#160;definition&#160;files&#160;are&#160;loaded&#46;&#160;&#40;see&#160;store&#160;notes</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>163</code></div><code>&#160;<span class='state-2'>for&#160;more&#160;about&#160;this&#46;&#41;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>164</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#40;location&#160;&#58;initarg&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>165</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;accessor&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>166</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initform&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;directory</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>167</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;user&#45;homedir&#45;pathname&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>168</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#34;multiverse&#34;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>169</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;documentation&#160;&#34;Directory&#160;path&#160;to&#160;stores&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>170</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Universes&#160;are&#160;held&#160;by&#160;a&#160;multiverse&#160;to&#160;make&#160;up&#160;a&#160;group&#160;of&#160;databases&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>171</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>172</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;cl&#58;print&#45;object&#160;&#40;&#40;shard&#160;shard&#41;&#160;stream&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>173</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;if&#160;&#42;print&#45;readably&#42;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>174</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#40;&#126;S&#160;&#126;S&#41;&#34;&#160;&#40;class&#45;name&#160;&#40;class&#45;of&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>175</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;status&#160;&#40;slot&#45;value&#160;shard&#160;&#39;status&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>176</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;number&#45;of&#45;documents&#160;&#40;length&#160;&#40;documents&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>177</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#160;there&#39;s&#160;no&#160;bt&#58;lock&#45;name&#160;function&#44;&#160;so&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>178</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;locks&#160;&#40;mapcar&#160;&#40;function&#160;princ&#45;to&#45;string&#41;&#160;&#40;lock&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>179</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;mac&#160;&#40;mac&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>180</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;shard&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>181</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;print&#45;unreadable&#45;object&#160;&#40;shard&#160;stream&#160;&#58;type&#160;t&#160;&#58;identity&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>182</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#126;S&#34;&#160;&#40;list&#160;&#58;status&#160;&#40;slot&#45;value&#160;shard&#160;&#39;status&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>183</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;number&#45;of&#45;documents&#160;&#40;length&#160;&#40;documents&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>184</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;locks&#160;&#40;lock&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>185</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;mac&#160;&#40;mac&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>186</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;shard&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>187</code></div><code>&#160;<span class='state-2'>&#160;&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>188</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>189</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;print&#45;object&#160;&#40;&#40;collection&#160;collection&#41;&#160;stream&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>190</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;if&#160;&#42;print&#45;readably&#42;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>191</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#40;&#126;S&#160;&#126;S&#41;&#34;&#160;&#40;class&#45;name&#160;&#40;class&#45;of&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>192</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>193</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store&#160;&#40;store&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>194</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>195</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;shards&#160;&#40;shards&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>196</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;print&#45;unreadable&#45;object&#160;&#40;collection&#160;stream&#160;&#58;type&#160;t&#160;&#58;identity&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>197</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#126;S&#34;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>198</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store&#160;&#40;and&#160;</span><span class='state-10'>&#40;store&#160;</span><span class='state-2'>collection</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>199</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>200</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>201</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;shards&#160;&#40;map&#160;&#39;list&#160;&#40;function&#160;short&#45;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>202</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shards&#160;collection&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>203</code></div><code>&#160;<span class='state-2'>&#160;&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>204</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>205</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;print&#45;object&#160;&#40;&#40;store&#160;store&#41;&#160;stream&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>206</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;if&#160;&#42;print&#45;readably&#42;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>207</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#40;&#126;S&#160;&#126;S&#41;&#34;&#160;&#40;class&#45;name&#160;&#40;class&#45;of&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>208</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>209</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universe&#160;&#40;universe&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>210</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>211</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;collections&#160;&#40;collections&#160;store&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>212</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;print&#45;unreadable&#45;object&#160;&#40;store&#160;stream&#160;&#58;type&#160;t&#160;&#58;identity&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>213</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#126;S&#34;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>214</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universe&#160;&#40;and&#160;</span><span class='state-10'>&#40;universe&#160;</span><span class='state-2'>store</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>215</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;universe&#160;store&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>216</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>217</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;collections&#160;&#40;map&#160;&#39;list&#160;&#40;function&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>218</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;collections&#160;store&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>219</code></div><code>&#160;<span class='state-2'>&#160;&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>220</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>221</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;print&#45;object&#160;&#40;&#40;universe&#160;universe&#41;&#160;stream&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>222</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;if&#160;&#42;print&#45;readably&#42;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>223</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#40;&#126;S&#160;&#126;S&#41;&#34;&#160;&#40;class&#45;name&#160;&#40;class&#45;of&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>224</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>225</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;multiverse&#160;&#40;multiverse&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>226</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>227</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;stores&#160;&#40;stores&#160;universe&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>228</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;print&#45;unreadable&#45;object&#160;&#40;universe&#160;stream&#160;&#58;type&#160;t&#160;&#58;identity&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>229</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#126;S&#34;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>230</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;multiverse&#160;&#40;and&#160;</span><span class='state-10'>&#40;multiverse&#160;</span><span class='state-2'>universe</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>231</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;multiverse&#160;universe&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>232</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>233</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;stores&#160;&#40;map&#160;&#39;list&#160;&#40;function&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>234</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;stores&#160;universe&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>235</code></div><code>&#160;<span class='state-2'>&#160;&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>236</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>237</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;print&#45;object&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;stream&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>238</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;if&#160;&#42;print&#45;readably&#42;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>239</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#40;&#126;S&#160;&#126;S&#41;&#34;&#160;&#40;class&#45;name&#160;&#40;class&#45;of&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>240</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>241</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>242</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universes&#160;&#40;universes&#160;multiverse&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>243</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;print&#45;unreadable&#45;object&#160;&#40;multiverse&#160;stream&#160;&#58;type&#160;t&#160;&#58;identity&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>244</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;format&#160;stream&#160;&#34;&#126;S&#34;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>245</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>246</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universes&#160;&#40;map&#160;&#39;list&#160;&#40;function&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>247</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;universes&#160;multiverse&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>248</code></div><code>&#160;<span class='state-2'>&#160;&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>249</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>250</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;getx&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>251</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>252</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-6'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;name</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>253</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;name&#160;multiverse&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>254</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-9'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-9'>&#160;</span><span class='state-1'>&#58;universes</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>255</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;universes&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>256</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;universe&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>257</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;universe&#45;class&#160;multiverse&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>258</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>259</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;location&#160;multiverse&#41;</span><span class='state-1'>&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>260</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>261</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;&#40;setf&#160;getx&#41;&#160;&#40;value&#160;&#40;multiverse&#160;multiverse&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>262</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>263</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;name</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>264</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;name&#160;multiverse&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>265</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;universes</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>266</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;universes&#160;multiverse&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>267</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;universe&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>268</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;universe&#45;class&#160;multiverse&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>269</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>270</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;multiverse&#41;&#160;value&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>271</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>272</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;getx&#160;&#40;&#40;universe&#160;universe&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>273</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>274</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-6'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;multiverse</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>275</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;multiverse&#160;universe&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>276</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-6'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;name</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>277</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;name&#160;universe&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>278</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-9'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-9'>&#160;</span><span class='state-1'>&#58;stores</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>279</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;stores&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>280</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;store&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>281</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;store&#45;class&#160;universe&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>282</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>283</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;location&#160;universe&#41;</span><span class='state-1'>&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>284</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>285</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;&#40;setf&#160;getx&#41;&#160;&#40;value&#160;&#40;universe&#160;universe&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>286</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>287</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;multiverse</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>288</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;multiverse&#160;universe&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>289</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;name</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>290</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;name&#160;universe&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>291</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;stores</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>292</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;stores&#160;universe&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>293</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;store&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>294</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;store&#45;class&#160;universe&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>295</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>296</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;universe&#41;&#160;value&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>297</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>298</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;getx&#160;&#40;&#40;store&#160;store&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>299</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>300</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-6'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;universe</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>301</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;universe&#160;store&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>302</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-6'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-6'>&#160;</span><span class='state-1'>&#58;name</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>303</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;name&#160;store&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>304</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-9'>&#40;equalp&#160;</span><span class='state-1'>accessor</span><span class='state-9'>&#160;</span><span class='state-1'>&#58;collections</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>305</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;collections&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>306</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;collection&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>307</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;collection&#45;class&#160;store&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>308</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>309</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;location&#160;store&#41;</span><span class='state-1'>&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>310</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>311</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;&#40;setf&#160;getx&#41;&#160;&#40;value&#160;&#40;store&#160;store&#41;&#160;accessor&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>312</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#34;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>313</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;cond&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;universe</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>314</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;universe&#160;store&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>315</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;name</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>316</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;name&#160;store&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>317</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;collections</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>318</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;collections&#160;store&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>319</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;collection&#45;class</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>320</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;collection&#45;class&#160;store&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>321</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;</span><span class='state-10'>&#40;equalp&#160;</span><span class='state-2'>accessor</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;location</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>322</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;store&#41;&#160;value&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>323</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>324</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;short&#45;mac&#160;&#40;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>325</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Return&#160;a&#160;short&#160;string&#160;containing&#160;a&#160;prefix&#160;of&#160;the&#160;MAC&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>326</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>327</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;short&#45;mac&#160;&#40;&#40;shard&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>328</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;mac&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;mac&#160;shard&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>329</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;subseq&#160;mac&#160;0&#160;&#40;min&#160;8&#160;&#40;length&#160;mac&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>330</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>331</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;&#40;setf&#160;status&#41;&#160;&#40;new&#45;status&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>332</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;status&#160;&#40;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>333</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>334</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;&#40;setf&#160;status&#41;&#160;&#40;new&#45;status&#160;&#40;shard&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>335</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;setf&#160;&#40;slot&#45;value&#160;shard&#160;&#39;status&#41;&#160;new&#45;status&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>336</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>337</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;status&#160;&#40;&#40;shard&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>338</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;status&#160;&#40;slot&#45;value&#160;shard&#160;&#39;status&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>339</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;etypecase&#160;status</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>340</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;symbol&#160;status&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>341</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;cons&#160;&#160;&#160;</span><span class='state-2'>&#40;car&#160;status&#41;</span><span class='state-1'>&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>342</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>343</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;match&#45;shard&#160;&#40;filename&#160;shards&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>344</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Check&#160;filename&#160;against&#160;a&#160;list&#160;of&#160;shards&#160;to&#160;find&#160;the&#160;matching&#160;shard&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>345</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;dolist&#160;&#40;mac&#160;shards&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>346</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;when&#160;</span><span class='state-10'>&#40;search&#160;</span><span class='state-2'>&#40;typecase&#160;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>347</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#40;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>348</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#40;mac&#160;mac&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>349</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#40;t&#160;mac&#41;&#41;</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;format&#160;nil&#160;&#34;&#126;A&#34;&#160;filename&#41;</span><span class='state-10'>&#160;</span><span class='state-2'>&#58;test</span><span class='state-10'>&#160;</span><span class='state-2'>&#39;equal</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>350</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#40;return&#45;from&#160;match&#45;shard&#160;&#40;values&#160;mac&#160;filename&#41;&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>351</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>352</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;get&#45;shard&#160;&#40;collection&#160;shard&#45;mac&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>353</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Get&#160;the&#160;shard&#160;object&#160;by&#160;its&#160;mac&#46;&#160;Shard&#160;lookups&#160;are&#160;done&#160;so&#160;much&#160;that</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>354</code></div><code>&#160;<span class='state-2'>there&#160;is&#160;no&#160;choice&#160;but&#160;to&#160;cache&#160;them&#160;in&#160;a&#160;hashtable&#44;&#160;but&#160;that</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>355</code></div><code>&#160;<span class='state-2'>hashtable&#160;needs&#160;to&#160;be&#160;thread&#160;safe&#160;so&#160;using&#160;safe&#160;functions&#160;to&#160;get&#160;and</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>356</code></div><code>&#160;<span class='state-2'>set&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>357</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>358</code></div><code>&#160;<span class='state-2'>&#40;defvar&#160;&#42;shards&#45;cache&#45;lock&#42;&#160;&#40;bt&#58;make&#45;lock&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>359</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>360</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;get&#45;shard&#45;cache&#45;safe&#37;&#160;&#40;collection&#160;shard&#45;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>361</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;gethash&#45;safe&#160;&#40;frmt&#160;&#34;&#126;A&#45;&#126;A&#45;&#126;A&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>362</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;store&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>363</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>364</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or&#160;shard&#45;mac&#160;</span><span class='state-2'>&#40;name&#160;collection&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>365</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shards&#45;cache&#37;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>366</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;lock&#160;&#42;shards&#45;cache&#45;lock&#42;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>367</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>368</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;set&#45;shard&#45;cache&#45;safe&#37;&#160;&#40;collection&#160;shard&#45;mac&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>369</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;setf&#160;&#40;gethash&#45;safe&#160;&#40;frmt&#160;&#34;&#126;A&#45;&#126;A&#45;&#126;A&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>370</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;store&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>371</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>372</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or&#160;shard&#45;mac&#160;</span><span class='state-2'>&#40;name&#160;collection&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>373</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shards&#45;cache&#37;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>374</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;lock&#160;&#42;shards&#45;cache&#45;lock&#42;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>375</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>376</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>377</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;get&#45;shard&#160;&#58;around&#160;&#40;collection&#160;shard&#45;mac&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>378</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;shard&#160;&#40;get&#45;shard&#45;cache&#45;safe&#37;&#160;collection&#160;shard&#45;mac&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>379</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-5'>&#40;not&#160;shard&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>380</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;call&#45;next&#45;method&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>381</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;shard&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>382</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>383</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;make&#45;shard&#160;&#40;collection&#160;shard&#45;mac&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>384</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>385</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;make&#45;shard&#160;&#40;collection&#160;shard&#45;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>386</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Creates&#160;an&#160;instance&#160;of&#160;a&#160;shard&#160;using&#160;the&#160;supplied&#160;mac&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>387</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;make&#45;instance&#160;&#39;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>388</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;mac&#160;shard&#45;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>389</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>390</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>391</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;ensure&#45;location&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>392</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>393</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>394</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;shard&#45;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>395</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;log&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>396</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;status&#160;&#58;new&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>397</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>398</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;get&#45;shard&#160;&#40;collection&#160;shard&#45;mac&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>399</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;get&#45;shard&#45;cache&#45;safe&#37;&#160;collection&#160;shard&#45;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>400</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#35;&#124;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>401</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;find&#160;&#40;or&#160;shard&#45;mac&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>402</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;shards&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>403</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#58;test&#160;&#39;equal&#160;&#58;key&#160;&#39;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>404</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#124;&#35;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>405</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>406</code></div><code>&#160;<span class='state-2'>&#40;defvar&#160;&#42;shards&#45;macs&#45;cache&#45;lock&#42;&#160;&#40;bt&#58;make&#45;lock&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>407</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>408</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;get&#45;shard&#45;mac&#45;cache&#45;safe&#37;&#160;&#40;collection&#160;value&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>409</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;gethash&#45;safe&#160;value&#160;&#40;shards&#45;macs&#45;cache&#37;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>410</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;lock&#160;&#42;shards&#45;macs&#45;cache&#45;lock&#42;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>411</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>412</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;set&#45;shard&#45;mac&#45;cache&#45;safe&#37;&#160;&#40;collection&#160;value&#160;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>413</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;setf&#160;&#40;gethash&#45;safe&#160;value&#160;&#40;shards&#45;macs&#45;cache&#37;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>414</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;lock&#160;&#42;shards&#45;macs&#45;cache&#45;lock&#42;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>415</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mac&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>416</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>417</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;document&#45;shard&#45;mac&#160;&#40;collection&#160;document&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>418</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Calculating&#160;a&#160;mac&#160;is&#160;expensive&#160;so&#160;caching&#160;shard&#160;value&#160;macs&#160;in&#160;a&#160;hashtable&#160;but&#160;that&#160;hashtable&#160;needs&#160;to&#160;be&#160;thread&#160;safe&#160;so&#160;using&#160;safe&#160;functions&#160;to&#160;get&#160;and&#160;set&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>419</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>420</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#59;&#59;cant&#160;use&#160;lparallel&#160;the&#160;order&#160;of&#160;values&#160;are&#160;important&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>421</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;element&#160;&#40;shard&#45;elements&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>422</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;&#40;list&#160;element&#160;&#40;getx&#160;document&#160;element&#41;&#41;&#160;value&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>423</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>424</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;if&#160;value</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>425</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;mac&#160;&#40;get&#45;shard&#45;mac&#45;cache&#45;safe&#37;&#160;collection&#160;value&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>426</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;mac</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>427</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;mac&#160;&#40;naive&#45;impl&#58;make&#45;mac&#160;&#40;reverse&#160;value&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>428</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;set&#45;shard&#45;mac&#45;cache&#45;safe&#37;&#160;collection&#160;value&#160;mac&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>429</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mac&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>430</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;collection&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>431</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>432</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;query&#45;multiverse&#160;&#40;element&#160;fn&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>433</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Queries&#160;the&#160;multiverse&#160;element&#160;passed&#160;for&#160;an&#160;element&#160;or&#160;elements&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>434</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>435</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;query&#45;multiverse&#160;&#40;&#40;collection&#160;collection&#41;&#160;fn&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>436</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;result&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>437</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;fn&#45;result&#160;&#40;funcall&#160;fn&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>438</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;fn&#45;result</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>439</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;fn&#45;result&#160;result&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>440</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>441</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;query&#45;multiverse&#160;&#40;&#40;store&#160;store&#41;&#160;fn&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>442</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;result&#160;&#40;mapcar&#160;&#40;lambda&#160;&#40;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>443</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;query&#45;multiverse&#160;collection&#160;fn&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>444</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;collections&#160;store&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>445</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;fn&#45;result&#160;&#40;funcall&#160;fn&#160;store&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>446</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;fn&#45;result</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>447</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;fn&#45;result&#160;result&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>448</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>449</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;query&#45;multiverse&#160;&#40;&#40;universe&#160;universe&#41;&#160;fn&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>450</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;result&#160;&#40;mapcar&#160;&#40;lambda&#160;&#40;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>451</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;query&#45;multiverse&#160;store&#160;fn&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>452</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;stores&#160;universe&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>453</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;fn&#45;result&#160;&#40;funcall&#160;fn&#160;universe&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>454</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;fn&#45;result</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>455</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;fn&#45;result&#160;result&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>456</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>457</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;query&#45;multiverse&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;fn&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>458</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;result&#160;&#40;mapcar&#160;&#40;lambda&#160;&#40;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>459</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;query&#45;multiverse&#160;universe&#160;fn&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>460</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;universes&#160;multiverse&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>461</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;fn&#45;result&#160;&#40;funcall&#160;fn&#160;multiverse&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>462</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;fn&#45;result</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>463</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;fn&#45;result&#160;result&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>464</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>465</code></div><code>&#160;<span class='state-2'>&#40;defmacro&#160;get&#45;multiverse&#45;element&#42;&#160;&#40;parent&#160;child&#45;list&#45;name&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>466</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;parent&#37;&#160;&#40;gensym&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>467</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#37;&#160;&#40;gensym&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>468</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#96;&#40;let&#160;&#40;&#40;&#44;parent&#37;&#160;&#44;parent&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>469</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;&#44;name&#37;&#160;&#44;name&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>470</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;element&#160;&#40;&#44;child&#45;list&#45;name&#160;&#44;parent&#37;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>471</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;&#40;string&#45;equal&#160;&#44;name&#37;&#160;&#40;name&#160;element&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>472</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;return&#45;from&#160;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>473</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;element&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>474</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>475</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;get&#45;multiverse&#45;element&#160;&#40;element&#45;type&#160;parent&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>476</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Fetches&#160;an&#160;element&#160;of&#160;the&#160;type&#160;with&#160;matching&#160;name&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>477</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>478</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;get&#45;multiverse&#45;element&#160;&#40;&#40;element&#45;type&#160;&#40;eql&#160;&#58;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>479</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;multiverse&#160;multiverse&#41;&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>480</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;get&#45;multiverse&#45;element&#42;&#160;multiverse&#160;universes&#160;name&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>481</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>482</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;get&#45;multiverse&#45;element&#160;&#40;&#40;element&#45;type&#160;&#40;eql&#160;&#58;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>483</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;universe&#160;universe&#41;&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>484</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;get&#45;multiverse&#45;element&#42;&#160;universe&#160;stores&#160;name&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>485</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>486</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;get&#45;multiverse&#45;element&#160;&#40;&#40;element&#45;type&#160;&#40;eql&#160;&#58;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>487</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;store&#160;store&#41;&#160;name&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>488</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;get&#45;multiverse&#45;element&#42;&#160;store&#160;collections&#160;name&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>489</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>490</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;persist&#45;definition&#160;&#40;element&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>491</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Persists&#160;multiverse&#160;element&#160;definitions&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>492</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>493</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#45;definition&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>494</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;a&#160;multiverse&#160;definition&#160;and&#160;not&#160;what&#160;it&#160;contains&#33;&#160;Path&#160;to</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>495</code></div><code>&#160;<span class='state-1'>file&#160;is&#160;of&#160;this&#160;general&#160;format&#160;&#47;multiverse&#47;multiverse&#45;name&#46;universe&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>496</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>497</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;ensure&#45;location&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>498</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;location&#160;</span><span class='state-1'>multiverse</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>499</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Cannot&#160;persist&#160;the&#160;universe&#44;&#160;there&#160;is&#160;no&#160;location&#46;&#34;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>500</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>501</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;write&#45;to&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>502</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>503</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>504</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;name&#160;&#40;name&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>505</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;multiverse&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>506</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>507</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;class&#160;&#40;type&#45;of&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>508</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>509</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>510</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#58;if&#45;exists&#160;&#58;supersede&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>511</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>512</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;&#38;key&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>513</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;children&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>514</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>515</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;persist&#45;definition&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>516</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>517</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;when&#160;children&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>518</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;universe&#160;&#40;getx&#160;multiverse&#160;&#58;universes&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>519</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#160;universe&#160;&#58;definitions&#45;only&#45;p&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>520</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;children&#45;p&#160;children&#45;p&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>521</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>522</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#45;definition&#160;&#40;&#40;universe&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>523</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;a&#160;universe&#160;definition&#160;and&#160;not&#160;what&#160;it&#160;contains&#33;&#160;Path&#160;to&#160;file&#160;is&#160;of&#160;this&#160;general&#160;format</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>524</code></div><code>&#160;<span class='state-1'>&#47;multiverse&#47;universe&#45;name&#47;universe&#45;name&#46;universe&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>525</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>526</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;ensure&#45;location&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>527</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;location&#160;</span><span class='state-1'>universe</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>528</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Cannot&#160;persist&#160;the&#160;universe&#44;&#160;there&#160;is&#160;no&#160;location&#46;&#34;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>529</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>530</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;write&#45;to&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>531</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>532</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>533</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;name&#160;&#40;name&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>534</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;universe&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>535</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>536</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;class&#160;&#40;type&#45;of&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>537</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>538</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>539</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#58;if&#45;exists&#160;&#58;supersede&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>540</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>541</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#160;&#40;&#40;universe&#160;universe&#41;&#160;&#38;key&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>542</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;children&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>543</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>544</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;persist&#45;definition&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>545</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>546</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;when&#160;children&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>547</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;store&#160;&#40;getx&#160;universe&#160;&#58;stores&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>548</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#160;store&#160;&#58;definitions&#45;only&#45;p&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>549</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;children&#45;p&#160;children&#45;p&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>550</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>551</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#45;definition&#160;&#40;&#40;store&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>552</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;a&#160;store&#160;definition&#160;and&#160;not&#160;what&#160;it&#160;contains&#33;&#160;Path&#160;to&#160;file&#160;is&#160;of&#160;this&#160;general&#160;format</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>553</code></div><code>&#160;<span class='state-1'>&#47;universe&#47;store&#45;name&#47;store&#45;name&#46;store&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>554</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>555</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;ensure&#45;location&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>556</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;location&#160;</span><span class='state-1'>store</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>557</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Cannot&#160;persist&#160;the&#160;store&#44;&#160;there&#160;is&#160;no&#160;location&#46;&#34;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>558</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>559</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;write&#45;to&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>560</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>561</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>562</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;name&#160;&#40;name&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>563</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;store&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>564</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;list&#160;&#58;name&#160;&#40;name&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>565</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;class&#160;&#40;type&#45;of&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>566</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>567</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>568</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#58;if&#45;exists&#160;&#58;supersede&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>569</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>570</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#160;&#40;&#40;store&#160;store&#41;&#160;&#38;key&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>571</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;children&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>572</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;persist&#45;definition&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>573</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>574</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;when&#160;children&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>575</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;collection&#160;&#40;getx&#160;store&#160;&#58;collections&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>576</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#160;collection&#160;&#58;definitions&#45;only&#45;p&#160;definitions&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>577</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;children&#45;p&#160;children&#45;p&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>578</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>579</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#45;definition&#160;&#40;&#40;collection&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>580</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;a&#160;collection&#160;definition&#46;&#160;Path&#160;to&#160;file&#160;is&#160;of&#160;this&#160;general&#160;format&#160;&#47;multiverse&#47;universe&#47;store&#45;name&#47;collection&#45;name&#46;col&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>581</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>582</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;ensure&#45;location&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>583</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;location&#160;</span><span class='state-1'>collection</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>584</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Cannot&#160;persist&#160;the&#160;collection&#44;&#160;there&#160;is&#160;no&#160;location&#46;&#34;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>585</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>586</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;naive&#45;impl&#58;write&#45;to&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>587</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>588</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;&#40;store&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>589</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;name&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>590</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;col&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>591</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#40;list</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>592</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#58;name&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>593</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#58;class&#160;&#40;type&#45;of&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>594</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#58;location&#160;&#40;location&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>595</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#58;if&#45;exists&#160;&#58;supersede&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>596</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>597</code></div><code>&#160;<span class='state-0'>&#59;&#59;TODO&#58;&#160;handle&#160;hashtable&#160;with&#160;specialization</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>598</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;persist&#45;collection&#160;&#40;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>599</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;the&#160;documents&#160;in&#160;a&#160;collection&#160;in&#160;the&#160;order&#160;that&#160;they&#160;where&#160;added&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>600</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>601</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;channel&#160;&#40;lparallel&#58;make&#45;channel&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>602</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;shard&#160;&#40;shards&#160;collection&#41;&#160;&#58;parallel&#45;p&#160;t&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>603</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;lparallel&#58;submit&#45;task</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>604</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;channel</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>605</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;lambda&#160;&#40;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>606</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;naive&#45;impl&#58;&#58;with&#45;open&#45;file&#45;lock</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>607</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;stream&#160;&#40;location&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>608</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>609</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-6'>&#40;hash&#45;table&#45;p&#160;</span><span class='state-1'>&#40;documents&#160;shard&#41;</span><span class='state-6'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>610</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;maphash&#160;&#40;lambda&#160;&#40;key&#160;doc&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>611</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;declare&#160;&#40;ignore&#160;key&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>612</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#45;document</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>613</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>614</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>615</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;shard&#160;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>616</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;Documents&#160;come&#160;from&#160;a&#160;loaded&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>617</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;so&#160;duplicate&#160;checks&#160;where&#160;already&#160;done</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>618</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;dont&#45;add&#45;to&#45;collection&#45;p&#160;t</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>619</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;file&#45;stream&#160;stream&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>620</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;documents&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>621</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>622</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;doc&#160;&#40;documents&#160;shard&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>623</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>624</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#45;document&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>625</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>626</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;shard&#160;shard</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>627</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;Documents&#160;come&#160;from&#160;a&#160;loaded&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>628</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#59;&#59;so&#160;duplicate&#160;checks&#160;where&#160;already&#160;done</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>629</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;dont&#45;add&#45;to&#45;collection&#45;p&#160;t</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>630</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;file&#45;stream&#160;stream&#41;&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>631</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;dotimes&#160;&#40;i&#160;&#40;length&#160;&#40;shards&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>632</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;i</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>633</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;lparallel&#58;receive&#45;result&#160;channel&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>634</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>635</code></div><code>&#160;<span class='state-0'>&#35;&#124;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>636</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>637</code></div><code>&#160;<span class='state-0'>&#124;&#35;</span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>638</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;persist&#160;&#40;&#40;collection&#160;collection&#41;&#160;&#38;key&#160;definition&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>639</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;children&#45;p&#160;t&#41;</span><span class='state-1'>&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>640</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Persists&#160;a&#160;collection&#160;definition&#160;and&#160;the&#160;documents&#160;in&#160;a&#160;collection&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>641</code></div><code>&#160;<span class='state-1'>Path&#160;to&#160;file&#160;for&#160;data&#160;is&#160;this&#160;general&#160;format&#160;&#47;multiverse&#47;universe&#47;store&#45;name&#47;collection&#45;name&#47;collection&#45;name&#46;log&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>642</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;persist&#45;definition&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>643</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>644</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;unless&#160;definition&#45;only&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>645</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;when&#160;children&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>646</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;persist&#45;collection&#160;collection&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>647</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>648</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;add&#45;multiverse&#45;element&#160;&#40;parent&#160;element&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>649</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Adds&#160;an&#160;instance&#160;of&#160;a&#160;multiverse&#160;element&#160;to&#160;the&#160;parent&#160;instance&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>650</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>651</code></div><code>&#160;<span class='state-1'>&#40;defun&#160;set&#45;and&#45;ensure&#45;locations&#160;&#40;parent&#160;child&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>652</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#34;Used&#160;internally&#160;to&#160;create&#160;child&#160;location&#160;if&#160;it&#160;does&#160;not&#160;exist&#160;and&#160;to&#160;ensure&#160;the&#160;location&#160;exists&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>653</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#59;&#59;&#40;break&#160;&#34;&#63;&#160;&#126;S&#126;&#37;&#126;&#37;&#126;S&#34;&#160;parent&#160;child&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>654</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-5'>&#40;location&#160;</span><span class='state-1'>child</span><span class='state-5'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>655</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;ensure&#45;directories&#45;exist&#160;&#40;pathname&#160;&#40;location&#160;child&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>656</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>657</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;directory</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>658</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;parent&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>659</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;child&#41;&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>660</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>661</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;ensure&#45;directories&#45;exist&#160;location&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>662</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;child&#41;&#160;&#40;pathname&#160;location&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>663</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>664</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;add&#45;multiverse&#45;element&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;&#40;universe&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>665</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-5'>&#40;not&#160;&#40;multiverse&#160;</span><span class='state-1'>universe</span><span class='state-5'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>666</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;multiverse&#160;universe&#41;&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>667</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;eql&#160;</span><span class='state-1'>&#40;multiverse&#160;universe&#41;</span><span class='state-9'>&#160;</span><span class='state-1'>multiverse</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>668</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>669</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#40;format&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>670</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#34;&#126;A&#160;already&#160;references&#160;a&#160;different&#160;&#126;A&#160;instance&#33;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>671</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;string&#45;capitalize&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>672</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;multiverse&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>673</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>674</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;existing&#160;&#40;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>675</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;universe</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>676</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;multiverse&#160;&#40;name&#160;universe&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>677</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>678</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;existing&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>679</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;progn</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>680</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;multiverse&#160;universe&#41;&#160;multiverse&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>681</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;set&#45;and&#45;ensure&#45;locations&#160;multiverse&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>682</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pushnew&#160;universe&#160;&#40;universes&#160;multiverse&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>683</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Universe&#160;&#126;A&#160;already&#160;exists&#46;&#34;&#160;&#40;name&#160;existing&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>684</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>685</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>686</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>687</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;add&#45;multiverse&#45;element&#160;&#40;&#40;universe&#160;universe&#41;&#160;&#40;store&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>688</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-5'>&#40;not&#160;&#40;universe&#160;</span><span class='state-1'>store</span><span class='state-5'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>689</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;universe&#160;store&#41;&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>690</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;</span><span class='state-9'>&#40;eql&#160;</span><span class='state-1'>&#40;universe&#160;store&#41;</span><span class='state-9'>&#160;</span><span class='state-1'>universe</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>691</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>692</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#40;format&#160;nil</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>693</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#34;&#126;A&#160;already&#160;references&#160;a&#160;different&#160;&#126;A&#160;instance&#33;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>694</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;string&#45;capitalize&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>695</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;universe&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>696</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>697</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;existing&#160;&#40;get&#45;multiverse&#45;element</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>698</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;store</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>699</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;universe&#160;&#40;name&#160;store&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>700</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>701</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;existing&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>702</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;progn</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>703</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;universe&#160;store&#41;&#160;universe&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>704</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;set&#45;and&#45;ensure&#45;locations&#160;universe&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>705</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pushnew&#160;store&#160;&#40;stores&#160;universe&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>706</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Store&#160;&#126;A&#160;already&#160;exists&#46;&#34;&#160;&#40;name&#160;existing&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>707</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>708</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>709</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>710</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;add&#45;multiverse&#45;element&#160;&#40;&#40;store&#160;store&#41;&#160;&#40;collection&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>711</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;</span><span class='state-6'>&#40;store&#160;</span><span class='state-1'>collection</span><span class='state-6'>&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>712</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;store&#160;collection&#41;&#160;store&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>713</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;unless&#160;</span><span class='state-10'>&#40;eql&#160;</span><span class='state-2'>&#40;store&#160;collection&#41;</span><span class='state-10'>&#160;</span><span class='state-2'>store</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>714</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#40;error&#160;&#34;Collection&#160;already&#160;references&#160;a&#160;different&#160;store&#160;instance&#33;&#34;&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>715</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>716</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;let&#160;&#40;&#40;existing&#160;&#40;get&#45;multiverse&#45;element&#160;&#58;collection&#160;store&#160;&#40;name&#160;collection&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>717</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;existing&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>718</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>719</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;location&#160;&#40;location&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>720</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;when&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>721</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;ensure&#45;directories&#45;exist&#160;&#40;pathname&#160;location&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>722</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>723</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;location</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>724</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>725</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>726</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>727</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;defaults&#160;&#40;pathname&#160;&#40;location&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>728</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>729</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>730</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;log&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>731</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;version&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>732</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>733</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;ensure&#45;directories&#45;exist&#160;location&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>734</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>735</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;collection&#41;&#160;&#40;pathname&#160;location&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>736</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pushnew&#160;collection&#160;&#40;collections&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>737</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;store&#160;collection&#41;&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>738</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Collection&#160;&#126;A&#160;already&#160;exists&#46;&#34;&#160;&#40;name&#160;existing&#41;&#41;</span><span class='state-1'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>739</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>740</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>741</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;clear&#45;collection&#160;&#40;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>742</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Clears&#160;documents&#160;indexes&#160;etc&#160;from&#160;collection&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>743</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>744</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;clear&#45;collection&#160;&#40;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>745</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;do&#45;sequence&#160;&#40;shard&#160;&#40;shards&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>746</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;remhash&#160;&#40;frmt&#160;&#34;&#126;A&#45;&#126;A&#45;&#126;A&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>747</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;&#40;store&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>748</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;name&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>749</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;or&#160;&#40;mac&#160;shard&#41;&#160;</span><span class='state-2'>&#40;name&#160;collection&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>750</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;shards&#45;cache&#37;&#160;&#40;universe&#160;&#40;store&#160;collection&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>751</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;documents&#160;shard&#41;&#160;nil&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>752</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#40;setf&#160;shard&#160;nil&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>753</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>754</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;setf&#160;&#40;shards&#160;collection&#41;&#160;&#40;make&#45;array&#160;1&#160;&#58;fill&#45;pointer&#160;0&#160;&#58;adjustable&#160;t</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>755</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;initial&#45;element&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>756</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>757</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;remove&#45;multiverse&#45;element&#160;&#40;parent&#160;element&#160;&#38;key&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>758</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Removes&#160;an&#160;instance&#160;of&#160;a&#160;multiverse&#160;element&#160;from&#160;the&#160;parent&#160;instance&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>759</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>760</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;remove&#45;multiverse&#45;element&#160;&#40;&#40;store&#160;store&#41;&#160;&#40;collection&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>761</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#38;key&#160;remove&#45;data&#45;from&#45;disk&#45;p&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>762</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#34;By&#160;default&#160;this&#160;just&#160;removes&#160;the&#160;collection&#160;from&#160;the&#160;multiverse&#160;leaving&#160;data&#160;untouched&#46;&#160;If&#160;you&#160;want&#160;data&#160;on&#160;disk&#160;to&#160;be&#160;deleted&#160;as&#160;well&#160;set&#160;remove&#45;data&#45;from&#45;disk&#45;p&#160;to&#160;t&#46;&#34;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>763</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;clear&#45;collection&#160;collection&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>764</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;when&#160;remove&#45;data&#45;from&#45;disk&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>765</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;delete&#45;directory&#45;and&#45;files</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>766</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;directory</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>767</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;&#40;store&#160;collection&#41;&#41;&#160;&#59;&#59;&#40;user&#45;homedir&#45;pathname&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>768</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;collection&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>769</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#58;if&#45;does&#45;not&#45;exist&#160;&#58;ignore&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>770</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;setf&#160;&#40;collections&#160;store&#41;&#160;&#40;remove&#160;collection&#160;&#40;collections&#160;store&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>771</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>772</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;remove&#45;multiverse&#45;element&#160;&#40;&#40;multiverse&#160;multiverse&#41;&#160;&#40;universe&#160;universe&#41;&#160;&#38;key&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>773</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;Should&#160;we&#160;be&#160;bothering&#160;with&#160;this&#63;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>774</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;dolist&#160;&#40;store&#160;&#40;stores&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>775</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;collection&#160;&#40;collections&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>776</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;clear&#45;collection&#160;collection&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>777</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;setf&#160;&#40;universes&#160;multiverse&#41;&#160;&#40;remove&#160;universe&#160;&#40;universes&#160;multiverse&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>778</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>779</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;remove&#45;multiverse&#45;element&#160;&#40;&#40;universe&#160;universe&#41;&#160;&#40;store&#160;store&#41;&#160;&#38;key&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>780</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#59;&#59;Should&#160;we&#160;be&#160;bothering&#160;with&#160;this&#63;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>781</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;dolist&#160;&#40;collection&#160;&#40;collections&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>782</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;clear&#45;collection&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>783</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;setf&#160;&#40;stores&#160;universe&#41;&#160;&#40;remove&#160;universe&#160;&#40;stores&#160;universe&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>784</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>785</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;load&#45;data&#160;&#40;collection&#160;&#38;key&#160;shard&#45;macs&#160;parallel&#45;p&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>786</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Loads&#160;the&#160;data&#160;documents&#160;of&#160;a&#160;collection&#160;from&#160;file&#160;or&#160;files&#160;if&#160;sharding&#160;is&#160;used&#46;&#160;If&#160;the&#160;data&#160;is&#160;already&#160;loaded&#160;it&#160;wont&#160;reload&#160;it&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>787</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>788</code></div><code>&#160;<span class='state-2'>shard&#45;macs&#160;is&#160;a&#160;list&#160;of&#160;shard&#160;macs&#160;to&#160;indicate&#160;which&#160;shards&#160;should&#160;be&#160;used&#46;&#160;If&#160;no&#160;shards&#160;are&#160;specified&#160;all&#160;shards&#160;will&#160;be&#160;loaded&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>789</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>790</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;ensure&#45;location&#160;&#40;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>791</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Tries&#160;to&#160;find&#160;or&#160;build&#160;path&#160;to&#160;cl&#45;naive&#45;store&#160;files&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>792</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>793</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;ensure&#45;location&#160;&#40;&#40;object&#160;multiverse&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>794</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;</span><span class='state-6'>&#40;empty&#45;p&#160;</span><span class='state-1'>&#40;location&#160;object&#41;</span><span class='state-6'>&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>795</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>796</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;error&#160;&#34;Unverse&#160;location&#160;is&#160;not&#160;set&#46;&#34;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>797</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>798</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;ensure&#45;location&#160;&#40;&#40;object&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>799</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;</span><span class='state-6'>&#40;empty&#45;p&#160;</span><span class='state-1'>&#40;location&#160;object&#41;</span><span class='state-6'>&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>800</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>801</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;multiverse&#160;</span><span class='state-2'>object</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>802</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Universe&#160;multiverse&#160;not&#160;set&#44;&#160;cant&#160;ensure&#160;location&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>803</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;empty&#45;p&#160;</span><span class='state-2'>&#40;ensure&#45;location&#160;&#40;multiverse&#160;object&#41;&#41;</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>804</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>805</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>806</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;&#40;multiverse&#160;object&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>807</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;object&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>808</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;&#40;name&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>809</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;universe&#34;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>810</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Multiverse&#160;location&#160;is&#160;empty&#160;can&#39;t&#160;manufacture&#160;universe&#160;location&#160;from&#160;it&#46;&#34;&#41;&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>811</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>812</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;ensure&#45;location&#160;&#40;&#40;object&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>813</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;not&#160;</span><span class='state-6'>&#40;empty&#45;p&#160;</span><span class='state-1'>&#40;location&#160;object&#41;</span><span class='state-6'>&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>814</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>815</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;universe&#160;</span><span class='state-2'>object</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>816</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Store&#160;universe&#160;not&#160;set&#44;&#160;cant&#160;ensure&#160;location&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>817</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;empty&#45;p&#160;</span><span class='state-2'>&#40;ensure&#45;location&#160;&#40;universe&#160;object&#41;&#41;</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>818</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;name&#160;</span><span class='state-2'>object</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>819</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Store&#160;has&#160;no&#160;name&#160;cannot&#160;manufacture&#160;location&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>820</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>821</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>822</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;&#40;universe&#160;object&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>823</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;object&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>824</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;&#40;name&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>825</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;store&#34;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>826</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Universe&#160;location&#160;is&#160;empty&#160;can&#39;t&#160;manufacture&#160;store&#160;location&#160;from&#160;it&#46;&#34;&#41;&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>827</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>828</code></div><code>&#160;<span class='state-1'>&#40;defmethod&#160;ensure&#45;location&#160;&#40;&#40;object&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>829</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#40;if&#160;</span><span class='state-9'>&#40;and&#160;&#40;not&#160;</span><span class='state-6'>&#40;empty&#45;p&#160;</span><span class='state-1'>&#40;location&#160;object&#41;</span><span class='state-6'>&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>830</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-9'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-1'>&#40;equalp&#160;&#40;pathname&#45;type&#160;&#40;pathname&#160;&#40;location&#160;object&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>831</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-9'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#34;log&#34;&#41;</span><span class='state-9'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>832</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>833</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;store&#160;</span><span class='state-2'>object</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>834</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Collection&#160;store&#160;not&#160;set&#44;&#160;cant&#160;ensure&#160;location&#46;&#34;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>835</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;not&#160;&#40;empty&#45;p&#160;</span><span class='state-2'>&#40;ensure&#45;location&#160;&#40;store&#160;object&#41;&#41;</span><span class='state-10'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>836</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;setf&#160;&#40;location&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>837</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;cl&#45;fad&#58;merge&#45;pathnames&#45;as&#45;file</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>838</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;pathname&#160;&#40;location&#160;&#40;store&#160;object&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>839</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;make&#45;pathname&#160;&#58;directory</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>840</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;list&#160;&#58;relative&#160;&#40;name&#160;object&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>841</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;name&#160;&#40;name&#160;object&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>842</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#58;type&#160;&#34;log&#34;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>843</code></div><code>&#160;<span class='state-1'>&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;error&#160;&#34;Store&#160;location&#160;is&#160;empty&#160;can&#39;t&#160;manufacture&#160;collection&#160;location&#160;from&#160;it&#46;&#34;&#41;&#41;&#41;</span><span class='state-1'>&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>844</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>845</code></div><code>&#160;<span class='state-2'>&#40;defgeneric&#160;data&#45;loaded&#45;p&#160;&#40;container&#160;&#38;key&#160;&#42;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>846</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;&#58;documentation&#160;&#34;Checks&#160;if&#160;the&#160;data&#160;is&#160;loaded&#160;for&#160;the&#160;container&#44;&#160;be&#160;it&#160;universe&#160;&#44;&#160;store&#160;or&#160;collection&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>847</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>848</code></div><code>&#160;<span class='state-2'>NOTES&#58;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>849</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>850</code></div><code>&#160;<span class='state-2'>This&#160;physically&#160;checks&#160;each&#160;collection&#39;s&#160;underlying&#160;concrete&#160;data&#160;structure&#160;for&#160;data&#46;&#160;This&#160;is&#160;done&#160;because&#160;a&#160;collection&#160;can&#160;be&#160;empty&#160;and&#160;still&#160;loaded&#44;&#160;thus&#160;setting&#160;a&#160;status&#160;when&#160;loaded&#160;became&#160;confusing&#160;and&#160;could&#160;be&#160;missed&#160;by&#160;an&#160;over&#160;loading&#160;method&#46;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>851</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>852</code></div><code>&#160;<span class='state-2'>If&#160;you&#160;change&#160;the&#160;underlying&#160;container&#160;for&#160;&#40;shards&#160;collection&#41;&#160;or&#160;the&#160;container&#160;for&#160;&#40;docutments&#160;shard&#41;&#160;you&#160;have&#160;to&#160;implement&#160;data&#45;loaded&#45;p&#46;&#160;Your&#160;implementation&#160;is&#160;expected&#160;to&#160;physically&#160;check&#160;for&#160;document&#160;count&#160;&#62;&#160;0&#160;and&#160;not&#160;some&#160;status&#160;set&#46;&#160;Be&#160;smart&#160;about&#160;it&#160;you&#160;are&#160;not&#160;expected&#160;to&#160;return&#160;a&#160;count&#160;so&#160;dont&#160;waist&#160;time&#160;counting&#160;just&#160;check&#160;if&#160;there&#160;is&#160;at&#160;least&#160;one&#160;document&#160;in&#160;the&#160;container&#46;&#34;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>853</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>854</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;data&#45;loaded&#45;p&#160;&#40;&#40;collection&#160;collection&#41;&#160;&#38;key&#160;shard&#45;macs&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>855</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>856</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;all&#45;shards&#45;p&#160;nil&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>857</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;not&#160;shard&#45;macs&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>858</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;and&#160;collection</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>859</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;&#40;shards&#160;</span><span class='state-2'>collection</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>860</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;&#160;&#160;&#160;&#160;</span><span class='state-2'>&#40;&#62;&#160;&#40;fill&#45;pointer&#160;&#40;shards&#160;collection&#41;&#41;&#160;0&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>861</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;shard&#45;found&#160;&#40;shards&#160;collection&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>862</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;</span><span class='state-10'>&#40;or</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>863</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;equalp&#160;&#40;status&#160;shard&#45;found&#41;&#160;&#58;loaded&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>864</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</span><span class='state-10'>&#160;</span><span class='state-2'>&#40;&#62;&#160;&#40;length&#160;&#40;documents&#160;shard&#45;found&#41;&#41;&#160;0&#41;</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>865</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;shard&#45;found&#160;all&#45;shards&#45;p&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>866</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;nil&#160;all&#45;shards&#45;p&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>867</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>868</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;do&#45;sequence&#160;&#40;mac&#160;shard&#45;macs&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>869</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;let&#160;&#40;&#40;shard&#45;found&#160;&#40;cl&#45;naive&#45;store&#46;naive&#45;core&#58;&#58;get&#45;shard&#45;cache&#45;safe&#37;&#160;collection&#160;mac&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>870</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;if&#160;shard&#45;found</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>871</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;shard&#45;found&#160;all&#45;shards&#45;p&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>872</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;push&#160;nil&#160;all&#45;shards&#45;p&#41;&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>873</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>874</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;if&#160;all&#45;shards&#45;p</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>875</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;every&#160;&#40;lambda&#160;&#40;x&#41;&#160;x&#41;&#160;all&#45;shards&#45;p&#41;&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>876</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>877</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;data&#45;loaded&#45;p&#160;&#40;&#40;store&#160;store&#41;&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>878</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;loaded&#45;p&#160;t&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>879</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;collection&#160;&#40;collections&#160;store&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>880</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;</span><span class='state-10'>&#40;data&#45;loaded&#45;p&#160;</span><span class='state-2'>collection</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>881</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;return&#45;from&#160;data&#45;loaded&#45;p&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>882</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;loaded&#45;p&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>883</code></div><code>&#160;<span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>884</code></div><code>&#160;<span class='state-2'>&#40;defmethod&#160;data&#45;loaded&#45;p&#160;&#40;&#40;universe&#160;universe&#41;&#160;&#38;key&#160;&#38;allow&#45;other&#45;keys&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>885</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#40;let&#160;&#40;&#40;loaded&#45;p&#160;t&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>886</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#40;dolist&#160;&#40;store&#160;&#40;stores&#160;universe&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>887</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#40;unless&#160;</span><span class='state-10'>&#40;data&#45;loaded&#45;p&#160;</span><span class='state-2'>store</span><span class='state-10'>&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>888</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#40;return&#45;from&#160;data&#45;loaded&#45;p&#160;nil&#41;&#41;&#41;</span><span class='state-0'></span></code></div></nobr>
<nobr><div class='source'><div class='line-number'><code>889</code></div><code>&#160;<span class='state-2'>&#160;&#160;&#160;&#160;loaded&#45;p&#41;&#41;</code></div></body></html>